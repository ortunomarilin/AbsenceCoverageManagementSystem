@model AbsenceListViewModel

@{
    ViewData["Title"] = "Absence History";
}




<div class="view-header">
    <h3>Absence History</h3>
</div>

@if (TempData["Message"] != null)
{
    <div class="temp-data-message alert alert-success">
        <h6 class="m-0">
            <span>
                <i class="fas fa-check-square"></i>
            </span>
            Success
        </h6>
        <p class="small m-0">@TempData["Message"]</p>
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="temp-data-error">
        <h6>
            <i class="far fa-times-circle"></i>
            @TempData["ErrorMessage"]
        </h6>
    </div>
}


<div class="search-container shadow-sm">

    <form asp-action="Filter" method="post">

        <div class="form-row ">
            <div class="form-group col-md-2 ">
                <label class="form-label small ">From Date</label>
                <div class="input-group mr-2">
                    <div class="input-group">
                        <input id="SD" class="form-control  form-control-sm  bg-white" autocomplete="off" placeholder="mm/dd/yyyy" type="text" name="fromdate" asp-for="@Model.Route.FromDate" />
                        <div class="input-group-append">
                            <span class="input-group-text  form-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group col-md-2">
                <label class="form-label small ">To Date</label>
                <div class="input-group ">
                    <div class="input-group ">
                        <input id="ED" class="form-control form-control-sm bg-white" autocomplete="off" placeholder="mm/dd/yyyy"  type="text" name="todate" asp-for="@Model.Route.ToDate" />
                        <div class="input-group-append">
                            <span class="input-group-text  form-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-row ">
            <div class="form-group col-md-2">
                <label class="form-label small ">Absence Types</label>
                <select class="form-control form-control-sm" name="filters" asp-for="@Model.Route.AbsenceType"
                        asp-items="@(new SelectList(Model.AbsenceTypes,
                                        "AbsenceTypeId", "Name", Model.Route.AbsenceType))">
                    <option value="all">All</option>
                </select>
            </div>
            <div class="form-group col-md-2">
                <label class="form-label small ">Duration</label>
                <select class="form-control form-control-sm" name="filters" asp-for="@Model.Route.Duration"
                        asp-items="@(new SelectList(Model.DurationTypes,
                                        "DurationTypeId", "Name", Model.Route.Duration))">
                    <option value="all">All</option>
                </select>
            </div>

            <div class="form-group col-md-2">
                <label class="form-label small ">Need Coverage</label>
                <select class="form-control form-control-sm" name="filters" asp-for="@Model.Route.NeedCoverage">
                    <option value="all">All</option>
                    <option value="true">Yes</option>
                    <option value="false">No</option>
                </select>
            </div>

            <div class="form-group col-md-2">
                <label class="form-label small ">Status</label>
                <select class="form-control form-control-sm" name="filters" asp-for="@Model.Route.Status"
                        asp-items="@(new SelectList(Model.StatusTypes,
                                        "StatusTypeId", "Name", Model.Route.Status))">
                    <option value="all">All </option>
                </select>
            </div>

            <div class=" ml-2 pt-4">
                <button type="submit" class="btn btn-sm btn-primary">Apply Filter</button>
            </div>
        </div>


    </form>

</div>



<div class="overflow-auto table-container">
    <div class="row justify-content-end">
            <div class="col-md-2 text-right">
                <label class="text-dark font-weight-bold ">Showing Page @Model.Route.PageNumber of @Model.TotalPages</label>
            </div>
        </div>


    <table class="table table-sm shadow-sm  mb-0">
        <thead>
            <tr>
                <th>
                    Date
                    <a asp-action="List"
                       asp-route-sortby="date"
                       asp-route-sortdirection="@(Model.Route.SortDirection == "asc" ? "desc" : "asc")"
                       asp-route-absencetype="@Model.Route.AbsenceType"
                       asp-route-duration="@Model.Route.Duration"
                       asp-route-status="@Model.Route.Status"
                       asp-route-pagenumber="@Model.Route.PageNumber"
                       asp-route-pagesize="@Model.Route.PageSize"
                       class=" @(Model.Route.SortBy == "date" ? "text-primary" : "text-secondary")">
                        <span>
                            <i class="fas fa-sort-down"></i>
                        </span>
                    </a>
                </th>
                <th>
                    Absent Type
                    <a asp-action="List"
                       asp-route-sortby="absencetype"
                       asp-route-sortdirection="@(Model.Route.SortDirection == "asc" ? "desc" : "asc")"
                       asp-route-absencetype="@Model.Route.AbsenceType"
                       asp-route-duration="@Model.Route.Duration"
                       asp-route-status="@Model.Route.Status"
                       asp-route-pagenumber="@Model.Route.PageNumber"
                       asp-route-pagesize="@Model.Route.PageSize"
                       class=" @(Model.Route.SortBy == "absencetype" ? "text-primary" : "text-secondary")">
                        <span>
                            <i class="fas fa-sort-down"></i>
                        </span>
                    </a>
                </th>
                <th>
                    Duration
                    <a asp-action="List"
                       asp-route-sortby="duration"
                       asp-route-sortdirection="@(Model.Route.SortDirection == "asc" ? "desc" : "asc")"
                       asp-route-absencetype="@Model.Route.AbsenceType"
                       asp-route-duration="@Model.Route.Duration"
                       asp-route-status="@Model.Route.Status"
                       asp-route-pagenumber="@Model.Route.PageNumber"
                       asp-route-pagesize="@Model.Route.PageSize"
                       class=" @(Model.Route.SortBy == "duration" ? "text-primary" : "text-secondary")">
                        <span>
                            <i class="fas fa-sort-down"></i>
                        </span>
                    </a>
                </th>
                <th>Time</th>
                <th>Need Coverage</th>
                <th>
                    Status
                    <a asp-action="List"
                       asp-route-sortby="status"
                       asp-route-sortdirection="@(Model.Route.SortDirection == "asc" ? "desc" : "asc")"
                       asp-route-absencetype="@Model.Route.AbsenceType"
                       asp-route-duration="@Model.Route.Duration"
                       asp-route-status="@Model.Route.Status"
                       asp-route-pagenumber="@Model.Route.PageNumber"
                       asp-route-pagesize="@Model.Route.PageSize"
                       class=" @(Model.Route.SortBy == "status" ? "text-primary" : "text-secondary")">
                        <span>
                            <i class="fas fa-sort-down"></i>
                        </span>
                    </a>
                </th>
                <th colspan="3"></th>
            </tr>
        </thead>
        <tbody>
            @foreach (AbsenceRequest ar in Model.AbsenceRequests)
            {
                <tr>
                    @if (ar.StartDate == ar.EndDate)
                    {
                        <td>@ar.StartDate.Value.ToShortDateString()</td>
                    }
                    else
                    {
                        <td>@ar.StartDate.Value.ToShortDateString() - @ar.EndDate.Value.ToShortDateString()</td>
                    }

                    <td>@ar.AbsenceType.Name</td>
                    <td>@ar.DurationType.Name</td>
                    <td>@ar.StartTime.Value.ToShortTimeString() - @ar.EndTime.Value.ToShortTimeString()</td>
                    <td>@(ar.NeedCoverage == true ? "Yes" : "No")</td>
                    <td>@ar.StatusType.Name</td>


                    <td class="text-right">
                        <a class="btn btn-info btn-sm" asp-action="Details" asp-route-id="@ar.AbsenceRequestId">
                            <span>
                                <i class="fas fa-binoculars"></i>
                            </span>
                            @*Details*@
                        </a>
                    </td>

                    <td class="text-center">
                        <a class="btn btn-warning btn-sm" asp-action="Edit" asp-route-id="@ar.AbsenceRequestId">
                            <span>
                                <i class="fas fa-edit text-white"></i>
                            </span>
                            @*Edit*@
                        </a>
                    </td>
                    <td class="text-left">
                        <form method="post" asp-action="Delete" asp-route-id="@ar.AbsenceRequestId">
                            <button type="submit" class="btn btn-danger btn-sm">
                                <span>
                                    <i class="fas fa-trash-alt"></i>
                                </span>
                                @*Delete*@
                            </button>
                        </form>
                    </td>
                </tr>
            }

        </tbody>
    </table>

    @for (int i = 1; i <= Model.TotalPages; i++)
    {
        <a asp-action="List"
           asp-route-sortby="@Model.Route.SortBy"
           asp-route-absencetype="@Model.Route.AbsenceType"
           asp-route-duration="@Model.Route.Duration"
           asp-route-status="@Model.Route.Status"
           asp-route-pagenumber="@i"
           asp-route-pagesize="@Model.Route.PageSize"
           class="btn btn-link   @(i==Model.Route.PageNumber ? "active" : "" )">
            @if (i == Model.Route.PageNumber)
            {
                <u>@i</u>

            }
            else
            {
                @i
            }
        </a>
    }


</div>




<script>

    $(function () {
        $("#SD").datepicker({
            beforeShowDay: $.datepicker.noWeekends,
        });
    });

    $(function () {
        $("#ED").datepicker({
            beforeShowDay: $.datepicker.noWeekends,
        });
    });


</script>


